"use strict";(self.webpackChunkkpiece=self.webpackChunkkpiece||[]).push([[634],{634:(e,s,a)=>{a.r(s),a.d(s,{default:()=>o});var t=a(43),n=a(675),c=a(809),r=a(696),l=a(579);const o=()=>{const{scansaga:e,scanarc:s,selectedscan:a,selectedpagescan:o}=(0,n.g)(),i=(0,n.Zp)(),[u,d]=(0,t.useState)([]),[m,h]=(0,t.useState)([]),[f,p]=(0,t.useState)(!0),[g,x]=(0,t.useState)(!1),[j,N]=(0,t.useState)(0),[v,b]=(0,t.useState)(null),[w,S]=(0,t.useState)(!1),[$,k]=(0,t.useState)(!1),[y,E]=(0,t.useState)(o||1),[C,I]=(0,t.useState)([]),[O]=(0,t.useState)(new Audio("https://kpiece2.s3.eu-west-3.amazonaws.com/ost/tobecontinued.mp3"));(0,t.useEffect)((()=>{(async()=>{try{const e=await fetch("https://kpiece2.s3.eu-west-3.amazonaws.com/data/search.json");if(!e.ok)throw new Error("Impossible de r\xe9cup\xe9rer search.json");const s=await e.json();I(s)}catch(e){console.error(e)}})()}),[]),(0,t.useEffect)((()=>{if(!f&&!g&&u.length>0){const e=u[u.length-1];parseInt(o)===e+1&&(O.volume=.05,O.currentTime=0,O.play().catch((e=>console.error("Audio playback failed:",e))))}}),[o,u,f,g,O]);(0,t.useEffect)((()=>{(async()=>{try{const t=await fetch(`https://kpiece2.s3.eu-west-3.amazonaws.com/data/saga/${e}/${s}.json`);if(!t.ok)throw new Error("Failed to fetch scan data");const n=await t.json();h(n);const c=n.find((e=>e.scan===parseInt(a)));if(!c)throw new Error("Scan not found");{const t=c.maxpages,n=Array.from({length:t},((e,s)=>s+1));d(n),(t=>{x(!0);let n=0;t.forEach((c=>{const r=c<10?`0${c}`:c,l=new Image;l.src=`https://kpiece2.s3.eu-west-3.amazonaws.com/scan/${e}/${s}/${a}/${r}.png`,l.onload=()=>{n++;const e=Math.floor(n/t.length*100);N(e),n===t.length&&x(!1)},l.onerror=()=>{n++;const e=Math.floor(n/t.length*100);N(e),n===t.length&&x(!1)}}))})(n)}p(!1)}catch(v){b(v.message),p(!1)}})()}),[e,s,a]),(0,t.useEffect)((()=>{f||g||window.scrollTo(0,170)}),[o,f,g]),(0,t.useEffect)((()=>{E(o||1)}),[o]);const A=()=>g?(0,l.jsxs)("div",{className:"loading-container",children:[(0,l.jsxs)("div",{className:"spinner",children:[(0,l.jsx)("div",{className:"double-bounce1"}),(0,l.jsx)("div",{className:"double-bounce2"})]}),(0,l.jsxs)("p",{children:["Chargement des pages: ",j,"%"]}),(0,l.jsx)("div",{className:"scan-loading-progress-bar",children:(0,l.jsx)("div",{className:"scan-loading-progress",style:{width:`${j}%`}})})]}):(0,l.jsx)(r.A,{});if(f||g)return(0,l.jsx)(A,{});if(v)return(0,l.jsx)("div",{className:"scan-page-error",children:"Scan Non disponible"});const F=o&&u.includes(parseInt(o))?parseInt(o):1,T=u[u.length-1],z=parseInt(o)===T+1;const R=!u.includes(F)&&!z,J=t=>{i(`/scan/${e}/${s}/${a}/${t}`)},L=e=>{const s=e.currentTarget.getBoundingClientRect();if(e.clientX-s.left<s.width/2){if(1===F)return;J(F-1)}else J(F===T?T+1:F+1)},M=()=>{const e=parseInt(a)-1,s=C.find((s=>e>=s.firstscan&&e<=s.lastscan));s?i(`/scan/${s.saga}/${s.arc}/${e}/1`):console.log("Scan pr\xe9c\xe9dent introuvable dans searchData")},P=()=>{const e=parseInt(a)+1,s=C.find((s=>e>=s.firstscan&&e<=s.lastscan));s?i(`/scan/${s.saga}/${s.arc}/${e}/1`):console.log("Scan suivant introuvable dans searchData")},V=()=>{J(T)},B=()=>{const e=parseInt(y,10);e>=1&&e<=T?J(e):E(F)};let D=null;if(w)D=u.map((t=>{const n=t<10?`0${t}`:t;return(0,l.jsx)("img",{src:`https://kpiece2.s3.eu-west-3.amazonaws.com/scan/${e}/${s}/${a}/${n}.png`,alt:`Page ${n}`,className:"scan-page-image"},t)}));else if(z)D=(0,l.jsxs)("div",{className:"last-page",children:[(0,l.jsx)("h2",{children:" TO BE CONTINUED... "}),(0,l.jsx)("div",{className:"bouton-last-page next-scan",children:(0,l.jsxs)("button",{onClick:P,children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-right"})," Scan suivant"]})}),(0,l.jsx)("div",{className:"bouton-last-page back-page",children:(0,l.jsxs)("button",{onClick:V,children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-left"})," RETOUR"]})}),(0,l.jsx)("div",{className:"bouton-last-page back-scan",children:(0,l.jsxs)("button",{onClick:M,children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-left"})," Scan pr\xe9c\xe9dent"]})})]});else if(R)D=(0,l.jsxs)("div",{className:"final-view",children:[(0,l.jsxs)("button",{onClick:M,children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-left"})," Scan pr\xe9c\xe9dent"]}),(0,l.jsxs)("button",{onClick:P,children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-right"})," Scan suivant"]}),(0,l.jsxs)("button",{onClick:V,children:[(0,l.jsx)("i",{className:"fa-solid fa-arrow-left"})," Revenir \xe0 la lecture"]})]});else{const t=F<10?`0${F}`:F;D=(0,l.jsxs)("div",{className:"image-container",onClick:L,children:[(0,l.jsx)("div",{className:"left-half"}),(0,l.jsx)("div",{className:"right-half"}),(0,l.jsx)("img",{src:`https://kpiece2.s3.eu-west-3.amazonaws.com/scan/${e}/${s}/${a}/${t}.png`,alt:`Page ${t}`,className:"scan-page-image"})]})}return(0,l.jsxs)("div",{className:"scan-page",children:[(0,l.jsxs)("div",{className:"top-scan-element",children:[(0,l.jsxs)("div",{className:"page-counter",children:["Page ",(0,l.jsx)("input",{type:"text",value:y,onChange:e=>{const s=e.target.value;/^\d*$/.test(s)&&E(s)},onBlur:B,onKeyPress:e=>{"Enter"===e.key&&B()},style:{width:"50px",textAlign:"center"}})," / ",T]}),(0,l.jsx)("div",{className:"select-scan",children:(0,l.jsx)("select",{value:a,onChange:a=>{const t=a.target.value;i(`/scan/${e}/${s}/${t}/1`)},children:m.map((e=>(0,l.jsxs)("option",{value:e.scan,children:[e.scan," - ",e.name]},e.scan)))})})]}),!z&&(0,l.jsx)(c.A,{onFullScreen:()=>{document.fullscreenElement?document.exitFullscreen&&(document.body.classList.remove("fullscreen-mode"),document.exitFullscreen(),k(!1)):document.documentElement.requestFullscreen().then((()=>{k(!0),document.body.classList.add("fullscreen-mode")})).catch((e=>{console.error(`Error attempting to enable fullscreen: ${e.message}`)}))},onVerticalScan:()=>{S((e=>!e))},isFullScreen:$}),D,T&&!z&&!w&&(0,l.jsx)("div",{className:"page-progress-bar",children:(0,l.jsx)("div",{className:"page-progress",style:{width:F/T*100+"%"}})})]})}},809:(e,s,a)=>{a.d(s,{A:()=>r});var t=a(43),n=a(579);const c=()=>{var e;const[s,a]=(0,t.useState)({chill:[],danger:[],emotion:[],epic:[],fight:[],fun:[],mysterious:[],sad:[]}),[c,r]=(0,t.useState)((()=>{const e=localStorage.getItem("ostIsOn");return null!==e&&JSON.parse(e)})),[l,o]=(0,t.useState)((()=>{const e=localStorage.getItem("ostVolume");return null!==e?JSON.parse(e):50})),[i,u]=(0,t.useState)(""),[d,m]=(0,t.useState)(0),[h,f]=(0,t.useState)(!1),[p,g]=(0,t.useState)(!1),[x,j]=(0,t.useState)([]),N=(0,t.useRef)(null),v=async()=>{try{const e=await fetch("https://kpiece2.s3.eu-west-3.amazonaws.com/ost/ost.json");if(!e.ok)throw new Error("Failed to fetch OST info");const s=await e.json();return j(s),s}catch(e){return console.error("Error fetching OST info:",e),[]}},b=async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(!0);const t=(s||x||await v()).find((s=>s.name===e));if(!t)return console.error(`Aucune info trouv\xe9e pour le mood: ${e}`),f(!1),[];const n=t.ostname.map(((e,s)=>({fileName:`${s+1}.mp3`,displayName:e})));return a((s=>({...s,[e]:n}))),f(!1),n},w=async(e,a)=>{c||r(!0),f(!0);let t=s[e];if(t&&0!==t.length||(t=await b(e)),t&&t.length>0){a>=t.length?a=0:a<0&&(a=t.length-1);const s=t[a],n=`https://kpiece2.s3.eu-west-3.amazonaws.com/ost/${e}/${s.fileName}`;N.current&&(N.current.pause(),N.current.src=n,N.current.volume=l/100,N.current.oncanplaythrough=()=>{N.current.play().then((()=>{u(e),m(a),g(!0),f(!1)})).catch((e=>{console.error("Erreur lors de la lecture:",e),g(!1),f(!1)}))},N.current.onerror=()=>{console.error(`Erreur de chargement pour: ${n}`),g(!1),f(!1)})}else console.error(`Aucune piste trouv\xe9e pour l'ambiance: ${e}`),g(!1),f(!1)};return(0,t.useEffect)((()=>{!c&&N.current&&(N.current.pause(),g(!1))}),[c]),(0,t.useEffect)((()=>{if(c){(async()=>{f(!0);const e=await v();for(const s of e)await b(s.name,e);f(!1)})()}else N.current&&(N.current.pause(),g(!1))}),[c]),(0,t.useEffect)((()=>{if(N.current){const e=()=>{i&&w(i,d+1)};return N.current.addEventListener("ended",e),()=>{N.current&&N.current.removeEventListener("ended",e)}}}),[i,d]),(0,t.useEffect)((()=>{localStorage.setItem("ostIsOn",JSON.stringify(c))}),[c]),(0,n.jsxs)("div",{className:"ost-player",children:[(0,n.jsx)("div",{className:"ost-title",children:"OST"}),(0,n.jsx)("div",{className:"switch-container",children:(0,n.jsxs)("label",{className:"switch",children:[(0,n.jsx)("input",{type:"checkbox",checked:c,onChange:()=>r(!c)}),(0,n.jsx)("span",{className:"slider round"})]})}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"track-navigation",children:[(0,n.jsx)("button",{className:"prev-button",onClick:()=>{i&&w(i,d-1)},disabled:!i||h,children:(0,n.jsx)("i",{className:"fa-solid fa-backward-step"})}),(0,n.jsx)("button",{className:"play-pause-button",onClick:()=>{N.current&&(p?(N.current.pause(),g(!1)):N.current.src?N.current.play().then((()=>{g(!0)})).catch((e=>{console.error("Erreur lors de la reprise de lecture:",e)})):i&&w(i,d))},disabled:h||!i&&!(null!==(e=N.current)&&void 0!==e&&e.src),children:h?(0,n.jsx)("i",{className:"fa-solid fa-spinner fa-spin"}):p?(0,n.jsx)("i",{className:"fa-solid fa-pause"}):(0,n.jsx)("i",{className:"fa-solid fa-play"})}),(0,n.jsx)("button",{className:"next-button",onClick:()=>{i&&w(i,d+1)},disabled:!i||h,children:(0,n.jsx)("i",{className:"fa-solid fa-forward-step"})}),(0,n.jsx)("button",{className:"random-button",onClick:()=>{if(i&&s[i]&&s[i].length>0){let e;do{e=Math.floor(Math.random()*s[i].length)}while(e===d&&s[i].length>1);w(i,e)}},disabled:!i||h,children:(0,n.jsx)("i",{className:"fa-solid fa-shuffle"})})]}),(0,n.jsxs)("div",{className:"volume-container",children:[(0,n.jsx)("input",{type:"range",min:"0",max:"100",value:l,onChange:e=>{const s=e.target.value;o(s),localStorage.setItem("ostVolume",JSON.stringify(s)),N.current&&(N.current.volume=s/100)},className:"volume-slider"}),l,"%"]}),(0,n.jsx)("div",{className:"mood-buttons",children:Object.keys(s).map((e=>(0,n.jsx)("button",{className:`mood-button ${i===e?"active":""} ${h&&i!==e?"disabled":""}`,onClick:()=>(e=>{i!==e&&w(e,0)})(e),disabled:h&&i!==e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))}),(0,n.jsx)("div",{className:"current-audio",children:(0,n.jsxs)("p",{children:[" ",(0,n.jsx)("i",{className:"fa-solid fa-music"}),i&&s[i]&&s[i][d]?`  ${s[i][d].displayName}.mp3`:"Aucune Ost charg\xe9"]})}),(0,n.jsx)("audio",{ref:N})]})]})};const r=function(e){let{onFullScreen:s,onVerticalScan:a}=e;const[r,l]=t.useState(!0),o=r?{}:{position:"sticky",top:0,background:"black",borderRadius:0};return(0,n.jsxs)("div",{className:"scan-bar",style:o,children:[(0,n.jsx)("button",{onClick:s,className:"scan-bar-button",children:(0,n.jsx)("i",{className:"fa-solid fa-expand"})}),(0,n.jsx)("button",{onClick:()=>{l(!r),a&&a()},className:"scan-bar-button",children:(0,n.jsx)("i",{className:"fa-solid "+(r?"fa-arrows-up-down":"fa-arrows-left-right")})}),(0,n.jsx)(c,{})]})}}}]);
//# sourceMappingURL=634.f121375d.chunk.js.map